<!DOCTYPE html>
<html> 
<head> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="skulpt.min.js" type="text/javascript"></script> 
<script src="skulpt-stdlib.js" type="text/javascript"></script> 

</head> 
<link rel="stylesheet" href="style.css">

<body> 
<div class="container">
    <div class="topbar">
        <button type="button" onclick="runit()" class="run">Run</button> 
        <button type="button" onclick="stopit()" class="stop">Stop</button> 
    </div>
    <!-- Main area -->
    <div class="main">
      <!-- Sidebar -->
        <div class="sidebar">
            <h2>Files</h2>
            <ul>
                <li onclick="hello()">hello.py</li>
                <li onclick="game()">game.py</li>
                <li>task.py</li>
                <li onclick="read()">README.md</li>
            </ul>
        </div>
        <!-- Editor -->
      <div class="editor">
        <textarea id="yourcode" cols="40" rows="10">
# Open the files to start coding
        </textarea><br /> 
        <pre id="output" ></pre> 
        <!-- If you want turtle graphics include a canvas
        <div id="mycanvas"></div> 
    -->
      </div>
    </div>
<!--<form> 
<textarea id="yourcode" cols="40" rows="10">
print("Hello World")
</textarea><br /> 
</form> 
<pre id="output" ></pre> 
<div id="mycanvas"></div> 
-->

<script type="text/javascript"> 
// output functions are configurable.  This one just appends some text
// to a pre element.
function outf(text) { 
    var mypre = document.getElementById("output"); 
    mypre.innerHTML = mypre.innerHTML + text; 
} 
function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}
// Sample file contents
    const fileContents = {
      "hello.py": `print("Hello world!")`,
      "game.py" : `question = input('Greetings! How may I help you in this fine day? (type stop to end, otherwise type continue)')
while question != 'stop':
    if question == 'continue':
        print("Im your guidance for today, you can call me Reo if you'd like to!")
    elif question == "What's the strangest thing in your refrigerator?":
        print("A dead rat. I think it was one of my friend's rat, please don't tell them I found their pet dead in my fridge.")
    elif question == 'Do you eat or drink soup?':
        print('What kind of question is that?! Are you okay? Its not too late to ask for help.')
    question = input('Greetings! How may I help you in this fine day? (type stop to end)')`,
      "README.md": `These are all sample files that you can edit and modify.
Click files in the sidebar to load their content into the editor.`
    }

// Function for each file
function hello() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["hello.py"];
}

function game() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["game.py"];
}

function read() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["README.md"];
}


// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function runit() { 
   var prog = document.getElementById("yourcode").value; 
   var mypre = document.getElementById("output"); 
   mypre.innerHTML = ''; 
   Sk.pre = "output";
   Sk.configure({output:outf, read:builtinRead}); 
   (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });
} 

function stopit() {
    // Clear the code input area
    var codeArea = document.getElementById("yourcode");
    if (codeArea) {
        codeArea.value = "";
    }
    // Clear the output area
    var mypre = document.getElementById("output");
    if (mypre) {
        mypre.innerHTML = "Execution stopped. Code cleared.";
    }
    // Reset Skulpt state (optional safeguard)
    Sk.execLimit = 0; // prevents further execution
    console.log("Code execution halted and cleared.");
}

const textarea = document.getElementById('myTextarea');

yourcode.addEventListener('keydown', function(e) {
  if (e.key === 'Tab') {
    e.preventDefault(); // Stop the default behavior
    const start = this.selectionStart;
    const end = this.selectionEnd;

    // Insert a tab (or 4 spaces) at the cursor position
    this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);

    // Move the cursor to the end of the inserted tab
    this.selectionStart = this.selectionEnd = start + 1;
  }
});


//t = turtle.Turtle()
//t.forward(100)
</script> 

</body> 

</html> 