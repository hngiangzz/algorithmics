<!DOCTYPE html>
<html> 
<head> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="skulpt.min.js" type="text/javascript"></script> 
<script src="skulpt-stdlib.js" type="text/javascript"></script> 

</head> 
<link rel="stylesheet" href="style.css">

<body> 
<div class="container">
    <div class="topbar">
        <button type="button" onclick="runit()" class="run">Run</button> 
        <button type="button" onclick="stopit()" class="stop">Stop</button> 
        <button type="button" style="visibility: hidden;" onclick="checkit()" class="check">Check</button> 
        <button type="button" onclick="toggleit()" class="theme-toggle">Toggle</button> 
    </div>
    <!-- Main area -->
    <div class="main">
      <!-- Sidebar -->
        <div class="sidebar">
            <h2>Files</h2>
            <ul>
                <li onclick="hello()">hello.py</li>
                <li onclick="game()">game.py</li>
                <li onclick="task()">task.py</li>
                <li onclick="read()">README.md</li>
            </ul>
            <button type="button" onclick="makeit()" class="new">+ New file</button> 
        </div>
        <!-- Editor -->
      <div class="editor">
        <textarea id="yourcode" cols="40" rows="10">
# Open the files to start coding
        </textarea><br /> 
        <!-- <pre id="output" ></pre> -->
        <textarea id="console"></textarea>
        <!-- If you want turtle graphics include a canvas
        <div id="mycanvas"></div> 
    -->
      </div>
    </div>
<!--<form> 
<textarea id="yourcode" cols="40" rows="10">
print("Hello World")
</textarea><br /> 
</form> 
<pre id="output" ></pre> 
<div id="mycanvas"></div> 
game 
while question != 'stop':
    if question == 'continue':
        print("Im your guidance for today, you can call me Reo if you'd like to!")
    elif question == "What's the strangest thing in your refrigerator?":
        print("A dead rat. I think it was one of my friend's rat, please don't tell them their pet is dead and in my fridge.")
    elif question == 'Do you eat or drink soup?':
        print('What kind of question is that?! Are you okay? Its not too late to ask for help.')
    question = input('Greetings! How may I help you in this fine day? (type stop to end)')`

runit code
line_number = 0;

   var prog = document.getElementById("yourcode").value; 
   var mypre = document.getElementById("output"); 
   mypre.innerHTML = ''; 
   Sk.pre = "output";
   Sk.configure({output:outf, read:builtinRead, inputfun: inputFunction, inputfunTakesPrompt: false}); 
   (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });
   x = int(input())
    result = x/2
    print(int(result))
-->
<script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
<script type="text/javascript"> 
// output functions are configurable.  This one just appends some text
// to a pre element.
function outf(text) { 
    var mypre = document.getElementById("output"); 
    mypre.innerHTML = mypre.innerHTML + text; 
} 
function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}
// Sample file contents
    const fileContents = {
      "hello.py": `print("Hello world!")`,
      "game.py" : `x = float(input())
result = x/2
print(result)`,
    "task.py": `Write a code that prints cat`,
      "README.md": `These are all sample files that you can edit and modify.
Click files in the sidebar to load their content into the editor.`
    }

    
// Function for each file
function hello() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["hello.py"];
    var button = document.querySelector(".check");
    button.style.visibility = "hidden";
}

function game() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["game.py"];
    var button = document.querySelector(".check");
    button.style.visibility = "hidden";
}
function task() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["task.py"];
    var button = document.querySelector(".check");
    button.style.visibility = "visible";
}

function read() {
    const editor = document.getElementById("yourcode");
    editor.value = fileContents["README.md"];
    var button = document.querySelector(".check");
    button.style.visibility = "hidden";
}
let line_number = 0;

function inputFunction(promptText) {
    let cur_input = myInput.value.split("\n")[line_number];
    line_number++;
    return cur_input;
}


// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function checkit(){
   const textarea = document.getElementById("console");
   var prog = document.getElementById("yourcode").value; 

    // Clear console for new run
    textarea.value = "";

    Sk.configure({
        output: function(text) {
            textarea.value += text;
        },

        inputfunTakesPrompt: true,
        inputfun: function(prompt) {
            return new Promise(resolve => {
                textarea.value += prompt;
// Wait for user to press Enter
                function handler(e) {
                    if (e.key === "Enter") {
                        e.preventDefault();

                        // Get the last line typed
                        const lines = textarea.value.split("\n");
                        const userInput = lines[lines.length - 1];

                        textarea.removeEventListener("keydown", handler);
                        resolve(userInput);
                        textarea.value += '\n';
                    }
                }

                textarea.addEventListener("keydown", handler);
            });
        }
    });

   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log(textarea.value.length)
       console.log('checked');
       let evil = textarea.value.slice(0, -1);
       if (evil === 'cat') {
        confetti({
            particleCount: 200,
            spread: 360,
            origin: { y: 0.6 }, // middle of the screen
        });
        textarea.value = 'Success!'
       } else {
        textarea.value = 'Failed..'
       }
   },
       function(err) {
       console.log(err.toString());
   });
}

function runit() {
   const textarea = document.getElementById("console");
   var prog = document.getElementById("yourcode").value; 

    // Clear console for new run
    textarea.value = "";

    Sk.configure({
        output: function(text) {
            textarea.value += text;
        },

        inputfunTakesPrompt: true,
        inputfun: function(prompt) {
            return new Promise(resolve => {
                textarea.value += prompt;
// Wait for user to press Enter
                function handler(e) {
                    if (e.key === "Enter") {
                        e.preventDefault();

                        // Get the last line typed
                        const lines = textarea.value.split("\n");
                        const userInput = lines[lines.length - 1];

                        textarea.removeEventListener("keydown", handler);
                        resolve(userInput);
                        textarea.value += '\n';
                    }
                }

                textarea.addEventListener("keydown", handler);
            });
        }
    });

   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });
} 

function makeit() {
    const editor = document.getElementById("yourcode");
    const consoleArea = document.getElementById("console");
    const checkBtn = document.querySelector(".check");
    const sidebarList = document.querySelector(".sidebar ul");
    const newFile = document.createElement("li");
    newFile.textContent = "new" + (sidebarList.children.length) + ".py"; 
    newFile.onclick = () => { 
        editor.value = " "; 
        checkBtn.style.visibility = "hidden"; 
    }; 
    sidebarList.appendChild(newFile);
}

function toggleit() {
  document.body.classList.toggle('light-theme');
  document.addEventListener("DOMContentLoaded", () => { 
  const toggleBtn = document.querySelector(".theme-toggle"); 
  toggleBtn.addEventListener("click", () => { 
  document.body.classList.toggle("light-theme"); }); });
}
function stopit() {
    // Clear the code input area
    var codeArea = document.getElementById("yourcode");
    if (codeArea) {
        codeArea.value = "";
    }
    // Clear the output area
    var mypre = document.getElementById("console");
    if (mypre) {
        mypre.value = "Execution stopped. Code cleared.";
    }
    // Reset Skulpt state (optional safeguard)
    Sk.execLimit = 0; // prevents further execution
    console.log("Code execution halted and cleared.");
}

const textarea = document.getElementById('myTextarea');

yourcode.addEventListener('keydown', function(e) {
  if (e.key === 'Tab') {
    e.preventDefault(); // Stop the default behavior
    const start = this.selectionStart;
    const end = this.selectionEnd;

    // Insert a tab (or 4 spaces) at the cursor position
    this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);

    // Move the cursor to the end of the inserted tab
    this.selectionStart = this.selectionEnd = start + 1;
  }
});


//t = turtle.Turtle()
//t.forward(100)
</script> 

</body> 

</html> 